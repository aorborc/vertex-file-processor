(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{3655:function(e,t,r){Promise.resolve().then(r.bind(r,2480))},2480:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var o=r(7437),n=r(2265);let d={bg:"#f5f6fa",text:"#2d3436",subText:"#636e72",card:"#ffffff",border:"#ecf0f1",accent:"#00b894",warn:"#d63031"},i=["Invoice_Number","Invoice_Date","Seller_GSTIN","Seller_PAN","Seller_Name","Buyer_GSTIN","Buyer_Name","Buyer_PAN","Ship_to_GSTIN","Ship_to_Name","Sub_Total_Amount","Discount_Amount","CGST_Amount","SGST_Amount","IGST_Amount","CESS_Amount","Additional_Cess_Amount","Total_Tax_Amount","IRN_Details"];function l(e){if(null==e)return"-";let t=Number(e);return Number.isNaN(t)?"-":"".concat((100*t).toFixed(1),"%")}function a(e){let t=(null==e?void 0:e.fields_confidence)||{},r=0,o=0;for(let e of i){let n=null==t?void 0:t[e];"number"==typeof n&&n>0&&(r+=n,o+=1)}return o?r/o:0}function s(){let[e,t]=(0,n.useState)(null),[r,s]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),[f,p]=(0,n.useState)("");async function b(){u(!0),s(null);try{let e=await fetch("/api/sampling-summary",{cache:"no-store",headers:{Accept:"application/json"}});if((e.headers.get("content-type")||"").toLowerCase().includes("application/json")){let r=await e.json();if(!e.ok)throw Error((null==r?void 0:r.error)||"Summary failed: ".concat(e.status));t(r)}else{let t=await e.text();throw Error("Summary failed: ".concat(e.status," ").concat(t.slice(0,300)))}}catch(e){s(String((null==e?void 0:e.message)||e))}finally{u(!1)}}(0,n.useEffect)(()=>{b()},[]),(0,n.useEffect)(()=>{p(new Intl.DateTimeFormat(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date))},[]);let h=(0,n.useMemo)(()=>((null==e?void 0:e.rows)||[]).filter(e=>{var t;let r=null==e?void 0:null===(t=e.fields)||void 0===t?void 0:t.Invoice_Number;return null!=r&&""!==String(r).trim()}),[e]),x=(0,n.useMemo)(()=>{if(!h.length)return 0;let e=h.map(e=>a(e));return e.reduce((e,t)=>e+t,0)/e.length},[h]);return(0,o.jsxs)("div",{style:{background:d.bg,minHeight:"100vh",padding:24,color:d.text,fontFamily:"Inter, system-ui, -apple-system, Segoe UI, Roboto"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16,gap:12},children:[(0,o.jsx)("h1",{style:{margin:0,fontSize:20},children:"Sampling Summary"}),(0,o.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,o.jsx)("a",{href:"/api/sampling-export",style:{textDecoration:"none"},children:(0,o.jsx)("span",{style:{padding:"8px 12px",borderRadius:8,border:"1px solid ".concat(d.accent),background:d.accent,color:"#fff",display:"inline-block"},children:"Download CSV"})}),(0,o.jsx)("button",{onClick:b,disabled:c,style:{padding:"8px 12px",borderRadius:8,border:"1px solid ".concat(d.border),background:"#fff",cursor:c?"default":"pointer"},children:c?"Refreshingâ€¦":"Refresh"})]})]}),r&&(0,o.jsx)("div",{style:{background:"#fff",border:"1px solid ".concat(d.warn,"33"),color:d.warn,padding:10,borderRadius:10,marginBottom:12},children:r}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:12,marginBottom:16},children:[(0,o.jsxs)("div",{style:{background:d.card,border:"1px solid ".concat(d.border),borderRadius:12,padding:16},children:[(0,o.jsx)("div",{style:{color:d.subText,fontSize:12,marginBottom:6},children:"Overall Avg Confidence"}),(0,o.jsx)("div",{style:{fontSize:28,fontWeight:700,color:d.accent},children:l(x)})]}),(0,o.jsxs)("div",{style:{background:d.card,border:"1px solid ".concat(d.border),borderRadius:12,padding:16},children:[(0,o.jsx)("div",{style:{color:d.subText,fontSize:12,marginBottom:6},children:"Included Rows"}),(0,o.jsx)("div",{style:{fontSize:24,fontWeight:600},children:h.length})]}),(0,o.jsxs)("div",{style:{background:d.card,border:"1px solid ".concat(d.border),borderRadius:12,padding:16},children:[(0,o.jsx)("div",{style:{color:d.subText,fontSize:12,marginBottom:6},children:"Generated"}),(0,o.jsx)("div",{style:{fontSize:14,color:d.subText},suppressHydrationWarning:!0,children:f||""})]})]}),(0,o.jsx)("div",{style:{marginBottom:6,fontWeight:600},children:"Details"}),(0,o.jsx)("div",{style:{overflowX:"auto"},children:(0,o.jsxs)("table",{style:{borderCollapse:"separate",borderSpacing:0,width:"100%",background:d.card,border:"1px solid ".concat(d.border),borderRadius:12,overflow:"hidden"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(d.border),textAlign:"left",padding:10,background:"#fafbff"},children:"Record ID"}),(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(d.border),textAlign:"left",padding:10,background:"#fafbff"},children:"Download URL"}),(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(d.border),textAlign:"right",padding:10,background:"#fafbff"},children:"Avg Confidence (%)"}),i.map(e=>(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(d.border),textAlign:"left",padding:10,background:"#fafbff"},children:e},e))]})}),(0,o.jsx)("tbody",{children:h.map(e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(d.border),padding:10},children:e.recordId}),(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(d.border),padding:10,maxWidth:320,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.zohoDownloadUrl?(0,o.jsx)("a",{href:e.zohoDownloadUrl,target:"_blank",rel:"noreferrer",style:{color:d.accent},children:"download"}):"-"}),(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(d.border),padding:10,textAlign:"right",color:d.text},children:l(a(e))}),i.map(t=>(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(d.border),padding:10},children:(()=>{var r,n;let i=function(e){if(null==e)return"-";if("string"==typeof e){let t=e.trim();return t.length?t:"-"}return String(e)}(null==e?void 0:null===(r=e.fields)||void 0===r?void 0:r[t]),a=null==e?void 0:null===(n=e.fields_confidence)||void 0===n?void 0:n[t];return(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{style:{color:d.text},children:i}),"number"==typeof a?(0,o.jsxs)("span",{style:{color:d.subText},children:[" (",l(a),")"]}):null]})})()},"".concat(e.recordId,"-").concat(t)))]},e.recordId||Math.random()))})]})})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3655)}),_N_E=e.O()}]);