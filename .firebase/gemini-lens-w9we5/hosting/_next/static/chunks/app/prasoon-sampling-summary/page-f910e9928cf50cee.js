(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[198],{6481:function(e,t,r){Promise.resolve().then(r.bind(r,2940))},2940:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var o=r(7437),n=r(29),i=r.n(n),d=r(2265);let a={bg:"#f5f6fa",text:"#2d3436",subText:"#636e72",card:"#ffffff",border:"#ecf0f1",accent:"#00b894",warn:"#d63031"},s=["Invoice_Number","Invoice_Date","Seller_GSTIN","Seller_PAN","Seller_Name","Buyer_GSTIN","Buyer_Name","Buyer_PAN","Ship_to_GSTIN","Ship_to_Name","Sub_Total_Amount","Discount_Amount","CGST_Amount","SGST_Amount","IGST_Amount","CESS_Amount","Additional_Cess_Amount","Total_Tax_Amount","IRN_Details"];function l(e){if(null==e)return"-";let t=Number(e);return Number.isNaN(t)?"-":"".concat((100*t).toFixed(1),"%")}function c(e){let t=(null==e?void 0:e.fields_confidence)||{},r=0,o=0;for(let e of s){let n=null==t?void 0:t[e];"number"==typeof n&&n>0&&(r+=n,o+=1)}return o?r/o:0}function u(){let[e,t]=(0,d.useState)(null),[r,n]=(0,d.useState)(null),[u,m]=(0,d.useState)(!1),[p,g]=(0,d.useState)({}),[b,h]=(0,d.useState)("avg"),[x,v]=(0,d.useState)("desc"),[y,S]=(0,d.useState)(!1),[j,w]=(0,d.useState)(""),[N,k]=(0,d.useState)(!1);async function I(){m(!0),n(null);try{let e=await fetch("/api/prasoon-sampling-summary",{cache:"no-store",headers:{Accept:"application/json"}}),r=(e.headers.get("content-type")||"").toLowerCase(),o=r.includes("application/json")?await e.json():{error:"Bad content-type: ".concat(r)};if(!e.ok)throw Error((null==o?void 0:o.error)||"Summary failed: ".concat(e.status));t(o)}catch(e){n(String((null==e?void 0:e.message)||e))}finally{m(!1)}}(0,d.useEffect)(()=>{I()},[]),(0,d.useEffect)(()=>{function e(){I()}return window.addEventListener("prasoon-retry-done",e),()=>{window.removeEventListener("prasoon-retry-done",e)}},[]);let _=(0,d.useMemo)(()=>(null==e?void 0:e.rows)||[],[e]),C=_.length,T=(0,d.useMemo)(()=>_.filter(e=>{var t;let r=null==e?void 0:null===(t=e.fields)||void 0===t?void 0:t.Invoice_Number;return null!=r&&""!==String(r).trim()}),[_]),A=(0,d.useMemo)(()=>{if(!_.length)return 0;let e=_.map(e=>c(e));return e.reduce((e,t)=>e+t,0)/e.length},[_]),B=(0,d.useMemo)(()=>{let e=p||{},t=Object.entries(e).some(e=>{let[t,r]=e;return""!==String(r||"").trim()}),r=_.filter(e=>{var t;return!N||!((null==e?void 0:null===(t=e.fields)||void 0===t?void 0:t.Invoice_Number)&&""!==String(e.fields.Invoice_Number).trim())});return t?r.filter(t=>{if(e.recordId&&!String(t.recordId||"").toLowerCase().includes(String(e.recordId).toLowerCase())||e.driveFileName&&!String(t.driveFileName||"").toLowerCase().includes(String(e.driveFileName).toLowerCase()))return!1;for(let o of s){var r;let n=String(e[o]||"").trim();if(!n)continue;let i=null==t?void 0:null===(r=t.fields)||void 0===r?void 0:r[o];if(!String(null!=i?i:"").toLowerCase().includes(n.toLowerCase()))return!1}return!0}):r},[_,p,N]),z=(0,d.useMemo)(()=>{let e=[...B],t="asc"===x?1:-1;return e.sort((e,r)=>{if("avg"===b)return t*(c(e)-c(r));if("recordId"===b)return t*String(e.recordId||"").localeCompare(String(r.recordId||""));if("driveFileName"===b)return t*String(e.driveFileName||"").localeCompare(String(r.driveFileName||""));if(s.includes(b)){var o,n;let i=null==e?void 0:null===(o=e.fields)||void 0===o?void 0:o[b],d=null==r?void 0:null===(n=r.fields)||void 0===n?void 0:n[b],a=Number(i),s=Number(d),l=!Number.isNaN(a)&&""!==String(i).trim(),c=!Number.isNaN(s)&&""!==String(d).trim();return l&&c?t*(a-s):t*String(i||"").localeCompare(String(d||""))}return 0}),e},[B,b,x]);return(0,o.jsxs)("div",{style:{background:a.bg,minHeight:"100vh",padding:24,color:a.text},children:[r&&(0,o.jsx)("div",{style:{background:"#fff",border:"1px solid ".concat(a.warn,"33"),color:a.warn,padding:10,borderRadius:10,marginBottom:12},children:r}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0,1fr))",gap:12,marginBottom:16},children:[(0,o.jsxs)("div",{style:{background:a.card,border:"1px solid ".concat(a.border),borderRadius:12,padding:16},children:[(0,o.jsx)("div",{style:{color:a.subText,fontSize:12,marginBottom:6},children:"Overall Avg Confidence"}),(0,o.jsx)("div",{style:{fontSize:28,fontWeight:700,color:a.accent},children:l(A)}),(0,o.jsx)("div",{style:{color:a.subText,fontSize:12,marginTop:4},children:"Includes rows without Invoice_Number (counted as 0)"})]}),(0,o.jsxs)("div",{style:{background:a.card,border:"1px solid ".concat(a.border),borderRadius:12,padding:16},children:[(0,o.jsx)("div",{style:{color:a.subText,fontSize:12,marginBottom:6},children:"Included Rows"}),(0,o.jsx)("div",{style:{fontSize:24,fontWeight:600},children:T.length}),(0,o.jsx)("div",{style:{color:a.subText,fontSize:12,marginTop:4},children:"Rows with a non-empty Invoice_Number"})]}),(0,o.jsxs)("div",{style:{background:a.card,border:"1px solid ".concat(a.border),borderRadius:12,padding:16},children:[(0,o.jsx)("div",{style:{color:a.subText,fontSize:12,marginBottom:6},children:"API Rows"}),(0,o.jsx)("div",{style:{fontSize:24,fontWeight:600},children:C}),(0,o.jsx)("div",{style:{color:a.subText,fontSize:12,marginTop:4},children:"All rows returned by the API"})]})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[(0,o.jsx)("div",{style:{fontWeight:600},children:"Details"}),(0,o.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:a.subText},children:[(0,o.jsx)("input",{type:"checkbox",checked:N,onChange:e=>k(e.target.checked)}),"Show only rows without Invoice_Number"]})]}),(0,o.jsxs)("div",{style:{position:"relative",overflowX:"auto"},children:[u&&(0,o.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.6)",zIndex:2},className:"jsx-5aa4d17410dedf9b",children:[(0,o.jsx)("div",{style:{width:32,height:32,border:"3px solid #ccc",borderTopColor:a.accent,borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-5aa4d17410dedf9b"}),(0,o.jsx)(i(),{id:"5aa4d17410dedf9b",children:"@-webkit-keyframes spin{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{from{-moz-transform:rotate(0);transform:rotate(0)}to{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{from{-o-transform:rotate(0);transform:rotate(0)}to{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{from{-webkit-transform:rotate(0);-moz-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]}),(0,o.jsxs)("table",{style:{borderCollapse:"separate",borderSpacing:0,width:"100%",background:a.card,border:"1px solid ".concat(a.border),borderRadius:12,overflow:"hidden"},children:[(0,o.jsxs)("thead",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid ".concat(a.border),textAlign:"left",padding:10,background:"#fafbff",cursor:"pointer"},onClick:()=>{h("recordId"),v("recordId"===b&&"asc"===x?"desc":"asc")},children:"Record ID"}),(0,o.jsx)("th",{style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid ".concat(a.border),textAlign:"left",padding:10,background:"#fafbff",cursor:"pointer",minWidth:200},onClick:()=>{h("driveFileName"),v("driveFileName"===b&&"asc"===x?"desc":"asc")},children:"Download"}),(0,o.jsx)("th",{style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid ".concat(a.border),textAlign:"right",padding:10,background:"#fafbff",cursor:"pointer"},onClick:()=>{h("avg"),v("avg"===b&&"asc"===x?"desc":"asc")},children:"Avg Confidence (%)"}),s.map(e=>(0,o.jsx)("th",{style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid ".concat(a.border),textAlign:"left",padding:10,background:"#fafbff",cursor:"pointer"},onClick:()=>{h(e),v(b===e&&"asc"===x?"desc":"asc")},children:e},e))]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(a.border),padding:8},children:(0,o.jsx)("input",{className:"input",placeholder:"filter id",value:p.recordId||"",onChange:e=>g(t=>({...t,recordId:e.target.value}))})}),(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(a.border),padding:8},children:(0,o.jsx)("input",{className:"input",placeholder:"filter file name",value:p.driveFileName||"",onChange:e=>g(t=>({...t,driveFileName:e.target.value}))})}),(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(a.border),padding:8},children:(0,o.jsx)("span",{style:{color:a.subText,fontSize:12},children:"avg"})}),s.map(e=>(0,o.jsx)("th",{style:{borderBottom:"1px solid ".concat(a.border),padding:8},children:(0,o.jsx)("input",{className:"input",placeholder:"filter",value:p[e]||"",onChange:t=>g(r=>({...r,[e]:t.target.value}))})},"f-".concat(e)))]})]}),(0,o.jsx)("tbody",{children:z.map(e=>{var t;let r=!!((null==e?void 0:null===(t=e.fields)||void 0===t?void 0:t.Invoice_Number)&&""!==String(e.fields.Invoice_Number).trim());return(0,o.jsxs)("tr",{style:{transition:"background 120ms ease"},children:[(0,o.jsxs)("td",{style:{borderBottom:"1px solid ".concat(a.border),padding:10,position:"relative",minWidth:160},children:[!N&&(0,o.jsx)("span",{children:e.recordId}),N&&!r&&(0,o.jsx)(f,{recordId:e.recordId,visible:!0,big:!0})]}),(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(a.border),padding:10,whiteSpace:"normal",wordBreak:"break-word",minWidth:200},children:e.downloadUrl?(0,o.jsx)("a",{href:e.downloadUrl,target:"_blank",rel:"noreferrer",style:{color:a.accent,textDecoration:"none"},children:e.driveFileName||"view invoice"}):e.driveFileName||"-"}),(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(a.border),padding:10,textAlign:"right"},children:l(c(e))}),s.map(t=>(0,o.jsx)("td",{style:{borderBottom:"1px solid ".concat(a.border),padding:10},children:(()=>{var r,n;let i=function(e){if(null==e)return"-";if("string"==typeof e){let t=e.trim();return t.length?t:"-"}return String(e)}(null==e?void 0:null===(r=e.fields)||void 0===r?void 0:r[t]),d=null==e?void 0:null===(n=e.fields_confidence)||void 0===n?void 0:n[t];return(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{children:i}),"number"==typeof d?(0,o.jsxs)("span",{style:{color:a.subText},children:[" (",l(d),")"]}):null]})})()},"".concat(e.recordId,"-").concat(t)))]},e.recordId||Math.random())})})]})]})]})}function f(e){let{recordId:t,visible:r,big:n}=e,[i,s]=(0,d.useState)(!1),[l,c]=(0,d.useState)(!1);async function u(){if(t&&!i){s(!0),c(!1);try{let e=await fetch("/api/prasoon-retry",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({recordId:t})}),r=await e.json();if(!e.ok)throw Error((null==r?void 0:r.error)||"Retry failed: ".concat(e.status));c(!0),window.dispatchEvent(new CustomEvent("prasoon-retry-done"))}catch(e){alert(String((null==e?void 0:e.message)||e))}finally{s(!1),setTimeout(()=>c(!1),2e3)}}}let f=n?a.accent:"#fff",m=n?"#fff":a.text;return(0,o.jsx)("button",{title:"Retry with Vertex",onClick:u,style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",opacity:r?1:0,pointerEvents:r?"auto":"none",transition:"opacity 120ms",padding:n?"8px 14px":"4px 8px",borderRadius:8,border:"1px solid ".concat(n?a.accent:a.border),background:f,color:m,fontSize:n?14:12,fontWeight:600,boxShadow:n?"0 1px 3px rgba(0,0,0,0.08)":"none"},className:"retry-btn",children:i?"Retryingâ€¦":l?"Done":"Retry Now"})}}},function(e){e.O(0,[29,971,117,744],function(){return e(e.s=6481)}),_N_E=e.O()}]);