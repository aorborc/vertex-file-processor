(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[763],{5301:function(e,t,l){Promise.resolve().then(l.bind(l,9942))},9942:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return d}});var n=l(7437),o=l(2265);function r(e){if(null==e)return"-";try{let t=Number(e);if(Number.isNaN(t))return"-";return t.toFixed(3)}catch(t){return String(e)}}function d(){let[e,t]=(0,o.useState)(!1),[l,d]=(0,o.useState)(null),[i,s]=(0,o.useState)(null),[a,c]=(0,o.useState)(null),u=(0,o.useMemo)(()=>{var e;return(null==i?void 0:null===(e=i.rows)||void 0===e?void 0:e.length)&&i.overall_avg_confidence||0},[i]);async function h(){c(null);try{let e=await fetch("/api/sampling-summary",{cache:"no-store"}),t=await e.json();if(!e.ok)throw Error((null==t?void 0:t.error)||"Summary failed: ".concat(e.status));s(t)}catch(e){c(String((null==e?void 0:e.message)||e))}}async function p(){t(!0),c(null);try{let e=await fetch("/api/sampling",{method:"POST"}),t=await e.json();if(!e.ok)throw Error((null==t?void 0:t.error)||"Sampling failed: ".concat(e.status));d({when:new Date().toISOString(),...t})}catch(e){c(String((null==e?void 0:e.message)||e))}finally{t(!1),await h()}}return(0,o.useEffect)(()=>{h()},[]),(0,n.jsxs)("div",{style:{padding:24,fontFamily:"system-ui, -apple-system, Segoe UI, Roboto"},children:[(0,n.jsx)("h1",{children:"Sampling"}),(0,n.jsxs)("p",{children:["Fetch 200 Zoho files, extract invoice fields via Vertex, and store results to Firestore collection ",(0,n.jsx)("code",{children:"Sampling"}),"."]}),(0,n.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,n.jsx)("button",{onClick:p,disabled:e,style:{padding:"8px 12px"},children:e?"Runningâ€¦":"Run Sampling (200)"}),(0,n.jsx)("button",{onClick:h,disabled:e,style:{padding:"8px 12px"},children:"Refresh Summary"})]}),a&&(0,n.jsxs)("p",{style:{color:"#b00"},children:["Error: ",a]}),l&&(0,n.jsxs)("div",{style:{marginTop:16},children:[(0,n.jsx)("strong",{children:"Last run:"})," processed ",l.processed,", failed ",l.failed,", overall avg ",r(l.avg_confidence_overall)]}),(0,n.jsx)("hr",{style:{margin:"16px 0"}}),(0,n.jsx)("h2",{children:"Summary"}),(0,n.jsxs)("div",{style:{marginBottom:8},children:[(0,n.jsx)("strong",{children:"Overall Avg Confidence:"})," ",r(u)]}),(0,n.jsx)("div",{style:{overflowX:"auto"},children:(()=>{let e=["Invoice_Number","Invoice_Date","Seller_GSTIN","Seller_PAN","Seller_Name","Buyer_GSTIN","Buyer_Name","Buyer_PAN","Ship_to_GSTIN","Ship_to_Name","Sub_Total_Amount","Discount_Amount","CGST_Amount","SGST_Amount","IGST_Amount","CESS_Amount","Additional_Cess_Amount","Total_Tax_Amount","IRN_Details"];return(0,n.jsxs)("table",{style:{borderCollapse:"collapse",width:"100%"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",textAlign:"left",padding:6},children:"Record ID"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",textAlign:"left",padding:6},children:"Download URL"}),(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",textAlign:"right",padding:6},children:"Avg Confidence"}),e.map(e=>(0,n.jsx)("th",{style:{borderBottom:"1px solid #ddd",textAlign:"left",padding:6},children:e},"".concat(e,"-val"))),e.map(e=>(0,n.jsxs)("th",{style:{borderBottom:"1px solid #ddd",textAlign:"right",padding:6},children:[e,"_conf"]},"".concat(e,"-conf")))]})}),(0,n.jsx)("tbody",{children:((null==i?void 0:i.rows)||[]).map(t=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:6},children:t.recordId}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:6,maxWidth:320,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.zohoDownloadUrl?(0,n.jsx)("a",{href:t.zohoDownloadUrl,target:"_blank",rel:"noreferrer",children:"download"}):"-"}),(0,n.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:6,textAlign:"right"},children:r(t.avg_confidence_score)}),e.map(e=>{var l,o;return(0,n.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:6},children:(null==t?void 0:null===(l=t.fields)||void 0===l?void 0:l[e])!=null&&(null==t?void 0:null===(o=t.fields)||void 0===o?void 0:o[e])!==""?String(t.fields[e]):"-"},"".concat(t.recordId,"-").concat(e,"-v"))}),e.map(e=>{var l;return(0,n.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:6,textAlign:"right"},children:r(null==t?void 0:null===(l=t.fields_confidence)||void 0===l?void 0:l[e])},"".concat(t.recordId,"-").concat(e,"-c"))})]},t.recordId||Math.random()))})]})})()})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5301)}),_N_E=e.O()}]);