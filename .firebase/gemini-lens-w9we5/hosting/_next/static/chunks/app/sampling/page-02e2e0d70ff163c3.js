(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[763],{5301:function(e,t,n){Promise.resolve().then(n.bind(n,9942))},9942:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(7437),o=n(2265);function i(e){if(null==e)return"-";let t=Number(e);return Number.isNaN(t)?"-":"".concat((100*t).toFixed(1),"%")}function l(){let[e,t]=(0,o.useState)(!1),[n,l]=(0,o.useState)(null),[d,s]=(0,o.useState)(null),[a,u]=(0,o.useState)(null),c=(0,o.useMemo)(()=>["Invoice_Number","Invoice_Date","Seller_GSTIN","Seller_PAN","Seller_Name","Buyer_GSTIN","Buyer_Name","Buyer_PAN","Ship_to_GSTIN","Ship_to_Name","Sub_Total_Amount","Discount_Amount","CGST_Amount","SGST_Amount","IGST_Amount","CESS_Amount","Additional_Cess_Amount","Total_Tax_Amount","IRN_Details"],[]);function f(e){let t=(null==e?void 0:e.fields_confidence)||{},n=0,r=0;for(let e of c){let o=null==t?void 0:t[e];"number"==typeof o&&o>0&&(n+=o,r+=1)}return r?n/r:0}let h=(0,o.useMemo)(()=>((null==d?void 0:d.rows)||[]).filter(e=>{var t;let n=null==e?void 0:null===(t=e.fields)||void 0===t?void 0:t.Invoice_Number;return null!=n&&""!==String(n).trim()}),[d]),g=(0,o.useMemo)(()=>{if(!h.length)return 0;let e=h.map(e=>f(e));return e.reduce((e,t)=>e+t,0)/e.length},[h]);async function m(){u(null);try{let e=await fetch("/api/sampling-summary",{cache:"no-store"}),t=await e.json();if(!e.ok)throw Error((null==t?void 0:t.error)||"Summary failed: ".concat(e.status));s(t)}catch(e){u(String((null==e?void 0:e.message)||e))}}async function p(){t(!0),u(null);try{let e=await fetch("/api/sampling",{method:"POST"}),t=await e.json();if(!e.ok)throw Error((null==t?void 0:t.error)||"Sampling failed: ".concat(e.status));l({when:new Date().toISOString(),...t})}catch(e){u(String((null==e?void 0:e.message)||e))}finally{t(!1),await m()}}return(0,o.useEffect)(()=>{m()},[]),(0,r.jsxs)("div",{style:{padding:24,fontFamily:"Inter, system-ui, -apple-system, Segoe UI, Roboto",background:"#f6f7fb",minHeight:"100vh"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[(0,r.jsx)("h1",{style:{margin:0,fontSize:20},children:"Invoice Sampling Dashboard"}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("button",{onClick:p,disabled:e,style:{padding:"8px 12px",borderRadius:8,border:"1px solid #ddd",background:e?"#eee":"white",cursor:e?"default":"pointer"},children:e?"Runningâ€¦":"Run Sampling (200)"}),(0,r.jsx)("button",{onClick:m,disabled:e,style:{padding:"8px 12px",borderRadius:8,border:"1px solid #ddd",background:"white",cursor:e?"default":"pointer"},children:"Refresh Summary"})]})]}),a&&(0,r.jsxs)("div",{style:{color:"#b00",marginBottom:12,background:"#fff",border:"1px solid #f3c0c0",padding:8,borderRadius:8},children:["Error: ",a]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:12,marginBottom:16},children:[(0,r.jsxs)("div",{style:{background:"white",border:"1px solid #e6e8ef",borderRadius:12,padding:16},children:[(0,r.jsx)("div",{style:{color:"#6b7280",fontSize:12,marginBottom:6},children:"Overall Avg Confidence"}),(0,r.jsx)("div",{style:{fontSize:28,fontWeight:600},children:i(g)})]}),(0,r.jsxs)("div",{style:{background:"white",border:"1px solid #e6e8ef",borderRadius:12,padding:16},children:[(0,r.jsx)("div",{style:{color:"#6b7280",fontSize:12,marginBottom:6},children:"Included Rows"}),(0,r.jsx)("div",{style:{fontSize:24,fontWeight:600},children:h.length})]}),(0,r.jsxs)("div",{style:{background:"white",border:"1px solid #e6e8ef",borderRadius:12,padding:16},children:[(0,r.jsx)("div",{style:{color:"#6b7280",fontSize:12,marginBottom:6},children:"Last Run Avg"}),(0,r.jsx)("div",{style:{fontSize:24,fontWeight:600},children:n?function(e){if(null==e)return"-";try{let t=Number(e);if(Number.isNaN(t))return"-";return t.toFixed(3)}catch(t){return String(e)}}(n.avg_confidence_overall):"-"})]})]}),(0,r.jsx)("div",{style:{marginBottom:6,color:"#374151",fontWeight:600},children:"Summary"}),(0,r.jsx)("div",{style:{overflowX:"auto"},children:(0,r.jsxs)("table",{style:{borderCollapse:"separate",borderSpacing:0,width:"100%",background:"white",border:"1px solid #e6e8ef",borderRadius:12,overflow:"hidden"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:{borderBottom:"1px solid #e6e8ef",textAlign:"left",padding:10,background:"#fafbff"},children:"Record ID"}),(0,r.jsx)("th",{style:{borderBottom:"1px solid #e6e8ef",textAlign:"left",padding:10,background:"#fafbff"},children:"Download URL"}),(0,r.jsx)("th",{style:{borderBottom:"1px solid #e6e8ef",textAlign:"right",padding:10,background:"#fafbff"},children:"Avg Confidence (%)"}),c.map(e=>(0,r.jsx)("th",{style:{borderBottom:"1px solid #e6e8ef",textAlign:"left",padding:10,background:"#fafbff"},children:e},"".concat(e,"-val")))]})}),(0,r.jsx)("tbody",{children:h.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:{borderBottom:"1px solid #f0f2f7",padding:10},children:e.recordId}),(0,r.jsx)("td",{style:{borderBottom:"1px solid #f0f2f7",padding:10,maxWidth:320,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.zohoDownloadUrl?(0,r.jsx)("a",{href:e.zohoDownloadUrl,target:"_blank",rel:"noreferrer",children:"download"}):"-"}),(0,r.jsx)("td",{style:{borderBottom:"1px solid #f0f2f7",padding:10,textAlign:"right"},children:i(f(e))}),c.map(t=>(0,r.jsx)("td",{style:{borderBottom:"1px solid #f0f2f7",padding:10},children:(()=>{var n,o;let l=function(e){if(null==e)return"-";if("string"==typeof e){let t=e.trim();return t.length?t:"-"}return String(e)}(null==e?void 0:null===(n=e.fields)||void 0===n?void 0:n[t]),d=i(null==e?void 0:null===(o=e.fields_confidence)||void 0===o?void 0:o[t]);return(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{style:{color:"#111827"},children:l}),"-"!==d?(0,r.jsxs)("span",{style:{color:"#6b7280"},children:[" (",d,")"]}):null]})})()},"".concat(e.recordId,"-").concat(t)))]},e.recordId||Math.random()))})]})})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5301)}),_N_E=e.O()}]);