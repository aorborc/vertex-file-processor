(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[639],{7308:function(e,i,n){Promise.resolve().then(n.bind(n,493))},493:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return c},dynamic:function(){return s}});var t=n(7437),l=n(2265),a=n(9376);let s="force-dynamic";function d(e){try{return JSON.parse(e)}catch(e){return null}}function c(){(0,a.useRouter)();let[e,i]=(0,l.useState)(""),[n,s]=(0,l.useState)(""),[c,r]=(0,l.useState)(null),[u,o]=(0,l.useState)(null),[p,v]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[h,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=d(localStorage.getItem("lastResult")),n=new URLSearchParams(window.location.search),t=n.get("gsUri")||n.get("gcsUri"),l=n.get("data"),a=t||(null==e?void 0:e.gcsUri)||(null==e?void 0:e.url)||"",s=(null==e?void 0:e.extracted)||null,c=(null==e?void 0:e.extractedRaw)||(null==e?void 0:e.vertex)||null;if(l){let e=d(decodeURIComponent(l));e&&(s=e.extracted||s,c=e.extractedRaw||c)}a&&i(a),s&&r(s),c&&o(c)},[]),(0,l.useEffect)(()=>{(async function(){if(e){v(!0),x(null);try{let i="".concat("https://us-central1-gemini-lens-w9we5.cloudfunctions.net/signedUrl","?gsUri=").concat(encodeURIComponent(e),"&ttlSec=604800"),n=await fetch(i),t=await n.json();if(!n.ok)throw Error((null==t?void 0:t.error)||"Failed to create signed URL");s(t.url)}catch(e){x(e.message||String(e))}finally{v(!1)}}})()},[e]);let[y,f]=(0,l.useState)({});function j(e){let i=parseFloat("string"==typeof e?e.replace(/[^0-9.+-]/g,""):e);return Number.isFinite(i)?i:0}function N(e,i){let n=(e||[]).reduce((e,i)=>e+j(i.amount),0),t=j(null==i?void 0:i.tax);return{subtotal:Number(n.toFixed(2)),total:Number((n+t).toFixed(2))}}function _(e,i){f(n=>{let t={...n,[e]:i};if("tax"===e){let{subtotal:e,total:i}=N(t.line_items,t);t.subtotal=e,t.total=i}return t})}function b(e,i,n){f(t=>{let l=Array.isArray(t.line_items)?[...t.line_items]:[],a=l[e]||{},s={...a,[i]:n},d=j("quantity"===i?n:a.quantity),c=j("unit_price"===i?n:a.unit_price);if("quantity"===i||"unit_price"===i){let e=Number((d*c).toFixed(2));s.quantity=d,s.unit_price=c,s.amount=e}else"amount"===i&&(s.amount=j(n));l[e]=s;let{subtotal:r,total:u}=N(l,t);return{...t,line_items:l,subtotal:r,total:u}})}async function w(){try{await navigator.clipboard.writeText(JSON.stringify({gcsUri:e,data:y},null,2)),g(!0),setTimeout(()=>g(!1),3e3)}catch(e){alert("Copied to clipboard failed: "+(e.message||String(e)))}}return(0,l.useEffect)(()=>{c&&"object"==typeof c&&f(c)},[c]),(0,t.jsxs)("main",{className:"split",children:[(0,t.jsxs)("div",{className:"panel",children:[(0,t.jsx)("h2",{style:{margin:"12px 0"},children:"Invoice Preview"}),(0,t.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,t.jsx)("input",{type:"text",value:e,onChange:e=>i(e.target.value),placeholder:"gs://bucket/path.pdf",className:"input",style:{flex:1}}),(0,t.jsxs)("button",{className:"btn",onClick:()=>i(e),disabled:!e||p,children:[(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M5 20h14v-2H5v2zm7-18l-5.5 9h11z"})}),"Load"]})]}),m&&(0,t.jsxs)("div",{className:"card",style:{color:"var(--danger)"},children:["Error: ",m]}),(0,t.jsx)("div",{className:"viewer",children:n?(0,t.jsx)("iframe",{title:"pdf",src:n,style:{width:"100%",height:"100%",border:"none"}}):(0,t.jsx)("div",{style:{padding:16,color:"#555"},children:p?"Generating viewer…":"Enter a gs:// URI to preview."})}),(0,t.jsx)("div",{className:"muted",style:{marginTop:8,fontSize:12},children:"Preview URL auto-refreshes as needed (valid up to 7 days)."})]}),(0,t.jsxs)("div",{className:"panel panel-scroll",style:{minWidth:360},children:[(0,t.jsx)("h2",{style:{margin:"12px 0"},children:"Review & Edit"}),(0,t.jsxs)("div",{className:"grid",style:{gap:10},children:[[["supplier_name","Supplier Name"],["supplier_address","Supplier Address"],["supplier_tax_id","Supplier Tax ID"],["invoice_number","Invoice #"],["invoice_date","Invoice Date"],["due_date","Due Date"],["bill_to","Bill To"],["ship_to","Ship To"],["currency","Currency"],["subtotal","Subtotal"],["tax","Tax"],["total","Total"]].map(e=>{var i,n,l,a;let[s,d]=e,r=null!==(l=null!==(n=null==y?void 0:y["".concat(s,"_confidence")])&&void 0!==n?n:null==c?void 0:null===(i=c.fields_confidence)||void 0===i?void 0:i[s])&&void 0!==l?l:null,u="number"!=typeof r||Number.isNaN(r)?"—":Math.round(100*r)+"%",o=["subtotal","tax","total"].includes(s),p=["subtotal","total"].includes(s);return(0,t.jsxs)("div",{className:"label",style:{gap:6},children:[d,(0,t.jsxs)("div",{className:"input-wrap",style:{maxWidth:o?260:void 0},children:[o&&(0,t.jsx)("span",{className:"input-leading-icon",children:"₹"}),(0,t.jsx)("input",{value:null!==(a=null==y?void 0:y[s])&&void 0!==a?a:"",onChange:e=>{let i=e.target.value;"tax"===s?_(s,String(i).replace(/[^0-9.\-]/g,"").replace(/(\..*)\./,"$1")):_(s,i)},className:"input ".concat(o?"leading":""," trailing"),readOnly:p}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:u})]})]},s)}),(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",minHeight:0,gap:8},children:[(0,t.jsx)("h3",{style:{margin:"8px 0"},children:"Line Items"}),(0,t.jsxs)("div",{className:"card",style:{padding:8,display:"flex",flexDirection:"column",minHeight:0,gap:8},children:[(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(240px,1fr) 110px 110px 120px 110px 140px 140px 48px",gap:12,fontWeight:600,marginBottom:8},children:[(0,t.jsx)("div",{children:"Description"}),(0,t.jsx)("div",{children:"Indent"}),(0,t.jsx)("div",{children:"Dispatch"}),(0,t.jsx)("div",{children:"Received"}),(0,t.jsx)("div",{children:"Qty"}),(0,t.jsx)("div",{children:"Unit Price"}),(0,t.jsx)("div",{children:"Amount"}),(0,t.jsx)("div",{className:"muted",children:"Del"})]}),(0,t.jsx)("div",{className:"scroll",style:{flex:1},children:((null==y?void 0:y.line_items)||[]).map((e,i)=>{var n,l,a,s,d,c,r,u,o,p,v,m,x,h,g,y,j,N,_,w,S;let C=null!==(l=null!==(n=null==e?void 0:e.description_confidence)&&void 0!==n?n:null==e?void 0:e.confidence)&&void 0!==l?l:null,q=null!==(s=null!==(a=null==e?void 0:e.indent_qty_confidence)&&void 0!==a?a:null==e?void 0:e.confidence)&&void 0!==s?s:null,R=null!==(c=null!==(d=null==e?void 0:e.dispatch_qty_confidence)&&void 0!==d?d:null==e?void 0:e.confidence)&&void 0!==c?c:null,T=null!==(u=null!==(r=null==e?void 0:e.received_qty_confidence)&&void 0!==r?r:null==e?void 0:e.confidence)&&void 0!==u?u:null,U=null!==(p=null!==(o=null==e?void 0:e.quantity_confidence)&&void 0!==o?o:null==e?void 0:e.confidence)&&void 0!==p?p:null,I=null!==(m=null!==(v=null==e?void 0:e.unit_price_confidence)&&void 0!==v?v:null==e?void 0:e.confidence)&&void 0!==m?m:null,M=null!==(h=null!==(x=null==e?void 0:e.amount_confidence)&&void 0!==x?x:null==e?void 0:e.confidence)&&void 0!==h?h:null,k=e=>"number"!=typeof e||Number.isNaN(e)?"—":Math.round(100*e)+"%";return(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(240px,1fr) 110px 110px 120px 110px 140px 140px 48px",gap:12,alignItems:"center",marginBottom:10},children:[(0,t.jsxs)("div",{className:"input-wrap",style:{minWidth:0},children:[(0,t.jsx)("input",{className:"input trailing",value:null!==(g=e.description)&&void 0!==g?g:"",onChange:e=>b(i,"description",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(C)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",inputMode:"decimal",style:{minWidth:110},value:null!==(y=e.indent_qty)&&void 0!==y?y:"",onChange:e=>b(i,"indent_qty",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(q)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",inputMode:"decimal",style:{minWidth:110},value:null!==(j=e.dispatch_qty)&&void 0!==j?j:"",onChange:e=>b(i,"dispatch_qty",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(R)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",style:{minWidth:120},value:null!==(N=e.received_qty)&&void 0!==N?N:"",onChange:e=>b(i,"received_qty",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(T)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",inputMode:"decimal",style:{minWidth:110},value:null!==(_=e.quantity)&&void 0!==_?_:"",onChange:e=>b(i,"quantity",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(U)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("span",{className:"input-leading-icon",children:"₹"}),(0,t.jsx)("input",{className:"input leading trailing",type:"text",inputMode:"decimal",style:{minWidth:140},value:null!==(w=e.unit_price)&&void 0!==w?w:"",onChange:e=>b(i,"unit_price",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(I)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("span",{className:"input-leading-icon",children:"₹"}),(0,t.jsx)("input",{className:"input leading trailing",type:"text",inputMode:"decimal",style:{minWidth:140},value:null!==(S=e.amount)&&void 0!==S?S:"",onChange:e=>b(i,"amount",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:k(M)})]}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{className:"btn warn",onClick:()=>{f(e=>({...e,line_items:(e.line_items||[]).filter((e,n)=>n!==i)}))},type:"button",title:"Remove row",style:{padding:8},children:(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M6 7h12v2H6zm2 3h8l-1 11H9L8 10zm3-7h2v2h-2z"})})})})]},i)})}),(0,t.jsxs)("button",{className:"btn secondary",type:"button",onClick:function(){f(e=>({...e,line_items:[...e.line_items||[],{description:"",quantity:0,unit_price:0,amount:0}]}))},style:{marginTop:8},children:[(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"})}),"Add line item"]})]})]}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("button",{className:"btn",type:"button",onClick:w,children:[(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16h13c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"})}),"Accept & Copy JSON"]}),h&&(0,t.jsx)("span",{style:{color:"green",alignSelf:"center"},children:"Copied!"})]})]}),(0,t.jsxs)("div",{style:{marginTop:16},children:[(0,t.jsx)("h3",{children:"Raw extracted (read-only)"}),(0,t.jsx)("pre",{className:"code mono",style:{maxHeight:240},children:JSON.stringify(u,null,2)})]})]})]})}},9376:function(e,i,n){"use strict";var t=n(5475);n.o(t,"useRouter")&&n.d(i,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7308)}),_N_E=e.O()}]);