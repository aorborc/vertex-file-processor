(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[639],{7308:function(e,i,n){Promise.resolve().then(n.bind(n,493))},493:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return d},dynamic:function(){return s}});var t=n(7437),l=n(2265),a=n(9376);let s="force-dynamic";function c(e){try{return JSON.parse(e)}catch(e){return null}}function d(){(0,a.useRouter)();let[e,i]=(0,l.useState)(""),[n,s]=(0,l.useState)(""),[d,r]=(0,l.useState)(null),[o,u]=(0,l.useState)(null),[p,m]=(0,l.useState)(null),[v,h]=(0,l.useState)(!1),[x,g]=(0,l.useState)(null),[y,f]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=c(localStorage.getItem("lastResult")),n=new URLSearchParams(window.location.search),t=n.get("gsUri")||n.get("gcsUri"),l=n.get("data"),a=t||(null==e?void 0:e.gcsUri)||(null==e?void 0:e.url)||"",s=(null==e?void 0:e.extracted)||null,d=(null==e?void 0:e.extractedRaw)||(null==e?void 0:e.vertex)||null;if(l){let e=c(decodeURIComponent(l));e&&(s=e.extracted||s,d=e.extractedRaw||d)}a&&i(a),s&&u(s),d&&m(d)},[]),(0,l.useEffect)(()=>{(async function(){if(e){h(!0),g(null);try{let i="".concat("https://us-central1-gemini-lens-w9we5.cloudfunctions.net/signedUrl","?gsUri=").concat(encodeURIComponent(e),"&ttlSec=604800"),n=await fetch(i),t=await n.json();if(!n.ok)throw Error((null==t?void 0:t.error)||"Failed to create signed URL");s(t.url),r({cached:!!t.cached,cachedAt:t.cachedAt||null,expires:t.expires})}catch(e){g(e.message||String(e))}finally{h(!1)}}})()},[e]);let[j,N]=(0,l.useState)({});function _(e){let i=parseFloat("string"==typeof e?e.replace(/[^0-9.+-]/g,""):e);return Number.isFinite(i)?i:0}function b(e,i){let n=(e||[]).reduce((e,i)=>e+_(i.amount),0),t=_(null==i?void 0:i.tax);return{subtotal:Number(n.toFixed(2)),total:Number((n+t).toFixed(2))}}function w(e,i){N(n=>{let t={...n,[e]:i};if("tax"===e){let{subtotal:e,total:i}=b(t.line_items,t);t.subtotal=e,t.total=i}return t})}function S(e,i,n){N(t=>{let l=Array.isArray(t.line_items)?[...t.line_items]:[],a=l[e]||{},s={...a,[i]:n},c=_("quantity"===i?n:a.quantity),d=_("unit_price"===i?n:a.unit_price);if("quantity"===i||"unit_price"===i){let e=Number((c*d).toFixed(2));s.quantity=c,s.unit_price=d,s.amount=e}else"amount"===i&&(s.amount=_(n));l[e]=s;let{subtotal:r,total:o}=b(l,t);return{...t,line_items:l,subtotal:r,total:o}})}async function C(){try{await navigator.clipboard.writeText(JSON.stringify({gcsUri:e,data:j},null,2)),f(!0),setTimeout(()=>f(!1),3e3)}catch(e){alert("Copied to clipboard failed: "+(e.message||String(e)))}}return(0,l.useEffect)(()=>{o&&"object"==typeof o&&N(o)},[o]),(0,t.jsxs)("main",{className:"split",children:[(0,t.jsxs)("div",{className:"panel",children:[(0,t.jsx)("h2",{style:{margin:"12px 0"},children:"Invoice Preview"}),(0,t.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,t.jsx)("input",{type:"text",value:e,onChange:e=>i(e.target.value),placeholder:"gs://bucket/path.pdf",className:"input",style:{flex:1}}),(0,t.jsxs)("button",{className:"btn",onClick:()=>i(e),disabled:!e||v,children:[(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M5 20h14v-2H5v2zm7-18l-5.5 9h11z"})}),"Load"]})]}),x&&(0,t.jsxs)("div",{className:"card",style:{color:"var(--danger)"},children:["Error: ",x]}),(0,t.jsx)("div",{className:"viewer",children:n?(0,t.jsx)("iframe",{title:"pdf",src:n,style:{width:"100%",height:"100%",border:"none"}}):(0,t.jsx)("div",{style:{padding:16,color:"#555"},children:v?"Generating viewer…":"Enter a gs:// URI to preview."})}),(0,t.jsxs)("div",{className:"card",style:{marginTop:8,padding:10},children:[(0,t.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("strong",{children:"Preview URL"}),(null==d?void 0:d.cached)&&(0,t.jsx)("span",{className:"badge",title:(()=>{let e=(null==d?void 0:d.cachedAt)?Date.parse(d.cachedAt):NaN;if(!Number.isNaN(e)){let i=Math.max(0,Math.floor((Date.now()-e)/6e4));return"Cached ".concat(i," min").concat(1===i?"":"s"," ago")}return"Cached"})(),children:"Cache: HIT"})]}),n?(0,t.jsx)("div",{className:"mono",style:{whiteSpace:"nowrap",overflowX:"auto",fontSize:12,marginTop:6},children:n}):(0,t.jsx)("div",{className:"muted",style:{fontSize:12},children:"Generate a preview to see the URL."})]})]}),(0,t.jsxs)("div",{className:"panel panel-scroll",style:{minWidth:360},children:[(0,t.jsx)("h2",{style:{margin:"12px 0"},children:"Review & Edit"}),(0,t.jsxs)("div",{className:"grid",style:{gap:10},children:[[["supplier_name","Supplier Name"],["supplier_address","Supplier Address"],["supplier_tax_id","Supplier Tax ID"],["invoice_number","Invoice #"],["invoice_date","Invoice Date"],["due_date","Due Date"],["bill_to","Bill To"],["ship_to","Ship To"],["currency","Currency"],["subtotal","Subtotal"],["tax","Tax"],["total","Total"]].map(e=>{var i,n,l,a;let[s,c]=e,d=null!==(l=null!==(n=null==j?void 0:j["".concat(s,"_confidence")])&&void 0!==n?n:null==o?void 0:null===(i=o.fields_confidence)||void 0===i?void 0:i[s])&&void 0!==l?l:null,r="number"!=typeof d||Number.isNaN(d)?"—":Math.round(100*d)+"%",u=["subtotal","tax","total"].includes(s),p=["subtotal","total"].includes(s);return(0,t.jsxs)("div",{className:"label",style:{gap:6},children:[c,(0,t.jsxs)("div",{className:"input-wrap",style:{maxWidth:u?260:void 0},children:[u&&(0,t.jsx)("span",{className:"input-leading-icon",children:"₹"}),(0,t.jsx)("input",{value:null!==(a=null==j?void 0:j[s])&&void 0!==a?a:"",onChange:e=>{let i=e.target.value;"tax"===s?w(s,String(i).replace(/[^0-9.\-]/g,"").replace(/(\..*)\./,"$1")):w(s,i)},className:"input ".concat(u?"leading":""," trailing"),readOnly:p}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:r})]})]},s)}),(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",minHeight:0,gap:8},children:[(0,t.jsx)("h3",{style:{margin:"8px 0"},children:"Line Items"}),(0,t.jsxs)("div",{className:"card",style:{padding:8,display:"flex",flexDirection:"column",minHeight:0,gap:8},children:[(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(240px,1fr) 110px 110px 120px 110px 140px 140px 48px",gap:12,fontWeight:600,marginBottom:8},children:[(0,t.jsx)("div",{children:"Description"}),(0,t.jsx)("div",{children:"Indent"}),(0,t.jsx)("div",{children:"Dispatch"}),(0,t.jsx)("div",{children:"Received"}),(0,t.jsx)("div",{children:"Qty"}),(0,t.jsx)("div",{children:"Unit Price"}),(0,t.jsx)("div",{children:"Amount"}),(0,t.jsx)("div",{className:"muted",children:"Del"})]}),(0,t.jsx)("div",{className:"scroll",style:{flex:1},children:((null==j?void 0:j.line_items)||[]).map((e,i)=>{var n,l,a,s,c,d,r,o,u,p,m,v,h,x,g,y,f,j,_,b,w;let C=null!==(l=null!==(n=null==e?void 0:e.description_confidence)&&void 0!==n?n:null==e?void 0:e.confidence)&&void 0!==l?l:null,R=null!==(s=null!==(a=null==e?void 0:e.indent_qty_confidence)&&void 0!==a?a:null==e?void 0:e.confidence)&&void 0!==s?s:null,q=null!==(d=null!==(c=null==e?void 0:e.dispatch_qty_confidence)&&void 0!==c?c:null==e?void 0:e.confidence)&&void 0!==d?d:null,T=null!==(o=null!==(r=null==e?void 0:e.received_qty_confidence)&&void 0!==r?r:null==e?void 0:e.confidence)&&void 0!==o?o:null,I=null!==(p=null!==(u=null==e?void 0:e.quantity_confidence)&&void 0!==u?u:null==e?void 0:e.confidence)&&void 0!==p?p:null,M=null!==(v=null!==(m=null==e?void 0:e.unit_price_confidence)&&void 0!==m?m:null==e?void 0:e.confidence)&&void 0!==v?v:null,U=null!==(x=null!==(h=null==e?void 0:e.amount_confidence)&&void 0!==h?h:null==e?void 0:e.confidence)&&void 0!==x?x:null,z=e=>"number"!=typeof e||Number.isNaN(e)?"—":Math.round(100*e)+"%";return(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(240px,1fr) 110px 110px 120px 110px 140px 140px 48px",gap:12,alignItems:"center",marginBottom:10},children:[(0,t.jsxs)("div",{className:"input-wrap",style:{minWidth:0},children:[(0,t.jsx)("input",{className:"input trailing",value:null!==(g=e.description)&&void 0!==g?g:"",onChange:e=>S(i,"description",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(C)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",inputMode:"decimal",style:{minWidth:110},value:null!==(y=e.indent_qty)&&void 0!==y?y:"",onChange:e=>S(i,"indent_qty",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(R)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",inputMode:"decimal",style:{minWidth:110},value:null!==(f=e.dispatch_qty)&&void 0!==f?f:"",onChange:e=>S(i,"dispatch_qty",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(q)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",style:{minWidth:120},value:null!==(j=e.received_qty)&&void 0!==j?j:"",onChange:e=>S(i,"received_qty",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(T)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("input",{className:"input trailing",type:"text",inputMode:"decimal",style:{minWidth:110},value:null!==(_=e.quantity)&&void 0!==_?_:"",onChange:e=>S(i,"quantity",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(I)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("span",{className:"input-leading-icon",children:"₹"}),(0,t.jsx)("input",{className:"input leading trailing",type:"text",inputMode:"decimal",style:{minWidth:140},value:null!==(b=e.unit_price)&&void 0!==b?b:"",onChange:e=>S(i,"unit_price",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(M)})]}),(0,t.jsxs)("div",{className:"input-wrap",children:[(0,t.jsx)("span",{className:"input-leading-icon",children:"₹"}),(0,t.jsx)("input",{className:"input leading trailing",type:"text",inputMode:"decimal",style:{minWidth:140},value:null!==(w=e.amount)&&void 0!==w?w:"",onChange:e=>S(i,"amount",e.target.value)}),(0,t.jsx)("span",{className:"input-trailing-badge",title:"confidence",children:z(U)})]}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{className:"btn warn",onClick:()=>{N(e=>({...e,line_items:(e.line_items||[]).filter((e,n)=>n!==i)}))},type:"button",title:"Remove row",style:{padding:8},children:(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M6 7h12v2H6zm2 3h8l-1 11H9L8 10zm3-7h2v2h-2z"})})})})]},i)})}),(0,t.jsxs)("button",{className:"btn secondary",type:"button",onClick:function(){N(e=>({...e,line_items:[...e.line_items||[],{description:"",quantity:0,unit_price:0,amount:0}]}))},style:{marginTop:8},children:[(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"})}),"Add line item"]})]})]}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("button",{className:"btn",type:"button",onClick:C,children:[(0,t.jsx)("svg",{className:"icon",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16h13c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"})}),"Accept & Copy JSON"]}),y&&(0,t.jsx)("span",{style:{color:"green",alignSelf:"center"},children:"Copied!"})]})]}),(0,t.jsxs)("div",{style:{marginTop:16},children:[(0,t.jsx)("h3",{children:"Raw extracted (read-only)"}),(0,t.jsx)("pre",{className:"code mono",style:{maxHeight:240},children:JSON.stringify(p,null,2)})]})]})]})}},9376:function(e,i,n){"use strict";var t=n(5475);n.o(t,"useRouter")&&n.d(i,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7308)}),_N_E=e.O()}]);